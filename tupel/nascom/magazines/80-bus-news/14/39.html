<?php columnStart(1); ?>
<p>
DRIVE ROUTINES FOR THE GEMINI GM822 RTC MODULE
</p>
<p>
OLED&rsquo;
O1FO&rdquo;
OFS&rsquo;
o1n4&rsquo;
O1F6&rdquo;
o1Fs&rsquo;
OFA&rsquo;
O1FD&rsquo;
0200&rsquo;
0203&rdquo;
0205&rdquo;
0207&rsquo;
O20A&rsquo;
0208&rdquo;
o20c&rsquo;
o20F&rsquo;
o2ti&rsquo;
0213&rdquo;
0216&rdquo;
0218&rdquo;
o21A&rsquo;
O21B&rsquo;
021D&rsquo;
O21F*
0222&rdquo;
0225&rdquo;
0228
0224&rdquo;
o22D&rsquo;
0230&rsquo;
0233&rdquo;
0235&rsquo;
0237&rdquo;
0239&rdquo;
0238&rdquo;
0238&rdquo;
</p>
<p>
0238&rdquo;
0243&rsquo;
0246!
0249&rdquo;
O24A&rsquo;
o24c&rsquo;
o24F&rsquo;
0251&rdquo;
</p>
<p>
cD
cD
AF
16
1B
OE
cp
21
</p>
<p>
11
</p>
<p>
ED
ED
3A
12
13
2i
</p>
<p>
ED
ED
2i
</p>
<p>
ED
ED
23
ED
ED
cD
ai
</p>
<p>
cD
OB
cD
21
</p>
<p>
cD
35
16
1E
OB
cD
C9
</p>
<p>
ED
34
</p>
<p>
3A
BT
28
cD
30
ai
</p>
<p>
OOFO&rsquo;
OOoF9&rsquo;
</p>
<p>
BO
40
1D
o121&rsquo;
o08B
O2BB&rsquo;
</p>
<p>
AO
008
</p>
<p>
0088
</p>
<p>
AQ
0082
AO
AO
</p>
<p>
AO
AO
o15t&rsquo;
ooe6c&rsquo;
o1cc3&rdquo;
01
0005
oosD&rsquo;
orcs!
o4
</p>
<p>
EE
45
</p>
<p>
o12i&rsquo;
</p>
<p>
73 O2cT&rdquo;
</p>
<p>
02D9&rdquo;
0080
</p>
<p>
oD
0261&rsquo;
08
0088 *
</p>
<p>
PE
</p>
<p>
am eR en ow
</p>
<p>
SET: CALL
CALL
XOR
LD
LD
LD
CALL
LD
LD
LDI
LDI
LD
LD
INC
LD
LDI
LDI
LD
LDI
LDI
INC
LDI
LDI
CALL
LD
CALL
</p>
<p>
CALL
RET
</p>
<p>
HEE
</p>
<p>
on ee aw
</p>
<p>
RTC: LD
LD
LD
OR
JR
CALL
JR
LD
</p>
<p>
RICi:
</p>
<p>
Set RIC from ASCII values at ARGS
eee Arguments are in the form HH:MM DD:MM.D &lsquo;*#HF
</p>
<p>
Read mA Set RIC to f from console
</p>
<p>
M-80 14 Sep 1982 14:48 PAGE 1-6
</p>
<p>
RHE
</p>
<p>
INDATA
</p>
<p>
ITNADDR
</p>
<p>
A
</p>
<p>
D, TEST+NOSTRB
E, TEST+WRSTRB
C, PADDR
</p>
<p>
WRITE
</p>
<p>
HL, IMONTH
</p>
<p>
DE, WSPACE
</p>
<p>
Get PIOs out of reset state
</p>
<p>
oo
</p>
<p>
Set non test mode
</p>
<p>
Get the month across&nbsp;...
&laquo;++ to the register workspace
</p>
<p>
eA en
</p>
<p>
A, (IDYWK)
</p>
<p>
(DE) A :
DE
</p>
<p>
HL, IDAY
</p>
<p>
Get day of the week
</p>
<p>
wn
</p>
<p>
an
</p>
<p>
Now the day
</p>
<p>
HL, [HOURS Now the hours&nbsp;...
</p>
<p>
on
</p>
<p>
HL &laquo;ee and the mins
</p>
<p>
on
</p>
<p>
WRRTC
</p>
<p>
HL, STMES
</p>
<p>
PRINT
</p>
<p>
c, CONIN
</p>
<p>
BDOS
</p>
<p>
HL, CRLF
</p>
<p>
PRINT
</p>
<p>
AA
</p>
<p>
D, START+NOSTRB
E, START+WRSTRB
C, PADDR
</p>
<p>
WRITE
</p>
<p>
Write out the work space
Wait for a key press&nbsp;...
</p>
<p>
an ee
</p>
<p>
eee to start
Start the RIC
</p>
<p>
on on
</p>
<p>
(STK), SP } Save the stack
SP, STACK
</p>
<p>
A, (ARGS-2) 3 Any ARGS given?
A
</p>
<p>
4,RTC2
</p>
<p>
VALID ; Yes, get and validate input
NC,RTC2
</p>
<p>
HL, ERMES ; Error, so tell &lsquo;em
</p>
<p>
DRIVE ROUTINES FOR THE GEMINI
</p>
<p>
0254&rdquo;
0257&rsquo;
0259&rsquo;
o2sc&rsquo;
0260
</p>
<p>
0261&rsquo;
0264&rsquo;
0267&rsquo;
O26A&rsquo;
026c&rdquo;
o26D&rsquo;
O26F&rdquo;
0272&rdquo;
0275&rdquo;
0278&rsquo;
0278&rdquo;
o27c&rsquo;
027E*
0280&rsquo;
0281&rdquo;
</p>
<p>
0282&rdquo;
0283&rsquo;
0286&rsquo;
0288&rdquo;
02489&rdquo;
0288&rdquo;
o28p&rsquo;
0285
O28F&rsquo;
0291 &lsquo;
0293&rsquo;
0294&rdquo;
0295&rsquo;
0296&rdquo;
0298&rdquo;
0294&rdquo;
029B&rsquo;
0290
o29n&rsquo;
02A0&rsquo;
O2Ai&rsquo;
O2A2&rdquo;
O2A3&rsquo;
</p>
<p>
O2A5&rsquo;
O2A6&rsquo;
</p>
<p>
cD
18
cD
BD
cg
</p>
<p>
21
cep
2i
36
</p>
<p>
OE
cD
21
cD
21
TE
FE
20
AF
cg
</p>
<p>
EB
a4
06
1A
FE
38
BE
23
39
D6
12
13
1A
FE
38
BE
23
30
D6
12
13
13
10
</p>
<p>
4A
FE
</p>
<p>
o1c3&rsquo; CALL
F3 JR
o16c&rsquo; REC2: CALL
7B O2cT&rsquo; LD
RET
</p>
<p>
EEE
</p>
<p>
ae ee
</p>
<p>
-*-
</p>
<p>
0000&rdquo; VALID: LD
o1c3&rsquo; CALL
9080 LD
19 LD
EX
OA LD
0005 CALL
oosp&rsquo; LD
o1c3&rsquo; CALL
0082 LD
LD
54 cp
02 JR
XOR
RET
</p>
<p>
ae ee
</p>
<p>
ALID(: EX
OOAE&rsquo; LD
04 LD
VALID2: LD
30 cp
25 JR
cp
INC
24 oR
30 SUB
LD
INC
LD
30 cP
18 aR
cP
INC
14 oR
30 SUB
LD
INC
INC
B3 DINZ
3 Do the day of
LD
30 cP
</p>
<p>
GMB22 RTC MODULE
</p>
<p>
PRINT
REC1
TIME
</p>
<p>
sp, (STK)
</p>
<p>
Get and validate input HEH
</p>
<p>
HL, TTLMES
PRINT
</p>
<p>
HL, ARGS-2
(HL), 25
DE, HL
</p>
<p>
C, LININ
BDOS
</p>
<p>
HL, CRLF
PRINT
</p>
<p>
HL, ARGS
A, CHL)
&lsquo;pt
</p>
<p>
NZ, VALID1
A
</p>
<p>
DE, HL
HL, INVAL
B,4
</p>
<p>
A, (DE)
&lsquo;gt
</p>
<p>
C, BRR
(HL)
</p>
<p>
HL
</p>
<p>
NC, ERR
30H
</p>
<p>
M-80 14 Sep 1982 14:48 PAGE 1-7
</p>
<p>
Else, read clock
Get the stack back
Back to CP/M
</p>
<p>
ae se ee
</p>
<p>
3; Put up the caption
</p>
<p>
3; Put the max string length at ARGS
</p>
<p>
ro
</p>
<p>
Point to the input buffer
</p>
<p>
Get the input
</p>
<p>
Test for time
</p>
<p>
-
</p>
<p>
No, so validate input
Yes, so clear any &lt;C&gt; flag
Done
</p>
<p>
an New
</p>
<p>
Validate the input string, and convert to nibbles
Do hours and mins, then days and months, then day of week
</p>
<p>
Point to ARGS in &lt;DED&gt;
Point to validation table
Do it 4 times
</p>
<p>
Get the input
</p>
<p>
Test if leas than O&nbsp;...
</p>
<p>
em am an am ow
</p>
<p>
$ se. Ov greater than (HL)
: Point to next (HL) for next time
</p>
<p>
Ok so convert to BCD nibble
</p>
<p>
(8), A; Put it back in workspace
</p>
<p>
1h (DE)
&lsquo;ot
</p>
<p>
C, BRR
(HL)
HL
</p>
<p>
NC, ERR
30H
(DE),A
DE
</p>
<p>
DE
VALID2
the week,
A, (DE)
&lsquo;ot
</p>
<p>
3 Point to next input&nbsp;...
3 &laquo;ee and do it all again
</p>
<p>
3; Skip the interdigit gap
</p>
<p>
3 More&nbsp;?
same as before
</p>
<?php columnEnd(1); ?>
