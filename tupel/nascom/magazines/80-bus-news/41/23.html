<?php columnStart(2, 2); ?>
<p>
CHKFIN:
</p>
<p>
CLIN: LD A, (LIN)
</p>
<p>
DEC A
</p>
<p>
LD (LIN),A
JR NZ, BACK
PUSH BC
</p>
<p>
LD HL, (CURPOS)
CALL PUTCUR
POP BC
</p>
<p>
LD DE, LINE
LD HL, CBUFF+3
LDA, (STRLEN)
LD BA
</p>
<p>
OR c
</p>
<p>
JP = Z,MATCH
BIT CSWTCH, (IX)
JR Z,CHKFIN
LD A,B
</p>
<p>
cP OC
</p>
<p>
JR NZ,NOMTCH
JR PRECMP
</p>
<p>
JR = Z, PRECMP
LD A.C
</p>
<p>
cP OB
</p>
<p>
JR C,NOMTCH
EX DE,HL
PUSH BC
</p>
<p>
LD B,0
</p>
<p>
ADD HL,BC
</p>
<p>
POP BC
</p>
<p>
LD C,B
</p>
<p>
LD B,0
</p>
<p>
OR A
</p>
<p>
SBC HL,BC
</p>
<p>
LD B,C
</p>
<p>
EX DE,HL
PRECMP: INC C
BEGCMP: PUSH BC
</p>
<p>
PUSH DE
</p>
<p>
PUSH HL
COMP: DEC C
</p>
<p>
JR 2, NOMTCH
</p>
<p>
BIT WSWTCH, (1X)
</p>
<p>
JR = Z, CHKUP
</p>
<p>
LD A, (HL)
</p>
<p>
CP WILD
</p>
<p>
JR 2, SKPCMP
</p>
<p>
CHKUP: BIT USWTCH, (1X)
</p>
<p>
JR NZ, USHIFT
LDA, (DE)
JR DOCOMP
</p>
<p>
USHIFT: LD A, (DE)
</p>
<p>
CP ota!
</p>
<p>
JR 8,DOCOMP
CP fat+l
</p>
<p>
JR NC, DOCOMP
SUB 20H
</p>
<p>
DOCOMP: IF DEBUG
</p>
<p>
PUSH AF
CALL PVID
LD A, (HL)
</p>
<p>
;COUNT LINE BACK
</p>
<p>
;IF REACHED LINE
</p>
<p>
;SAVE LINE LENGTH
</p>
<p>
;RESTORE CURSOR TO ORIG POSN
</p>
<p>
;RESTORE LINE LENGTH
;DE = @ DISPLAYED STRING
</p>
<p>
; IGNORE INITIAL SPACE &amp; LEADING &lsquo;
&gt;B = NO. CHARS IN STRING
</p>
<p>
;IF NULL STRING AND BLANK LINE
</p>
<p>
;CHECK COMPLETE LINE SWITCH
,IF NOT SET, ANY MATCH
</p>
<p>
; COMPARE LENGTHS
</p>
<p>
}IF DIFFERENT LENGTHS
</p>
<p>
BIT FSWTCH,(IX) ;CHECK FINISH OF LINE SWITCH
</p>
<p>
:IF NOT SET
</p>
<p>
:IF DISPLAYED LINE TOO SHORT
</p>
<p>
IL := @ LINE + (C) &ndash; (B), SAVE HL
;SAVE CHAR COUNTS
</p>
<p>
;RESTORE CHAR COUNTS
</p>
<p>
;MUST COMPARE SAME NO. CHARS AS STRING
</p>
<p>
;DE = @ OF END OF STRING, RESTORE HL
;C=COUNT CHARS IN DISPLAYED STRING+1
</p>
<p>
:SAVE START GF COMPARISON
</p>
<p>
;COUNT DISPLAYED CHARS TO BE COMPARED+1
</p>
<p>
:IF DISPLAYED LINE TOO SHORT
:CHECK FOR WILD CARDS
</p>
<p>
:IF NOT SET
</p>
<p>
;CHECK FOR WILD CARD IN STRING
</p>
<p>
;IF WILD CARD SKIP COMPARISON
; CHECK CASE SHIFT SWITCH
;IF CONVERT TQ UPPER CASE
;PICK UP DISPLAYED CHAR
</p>
<p>
:PICK UP DISPLAYED CHAR
;ENSURE UPPER CASE
</p>
<p>
;CONVERT TO UPPER CASE
</p>
<p>
:IF IN DEBUG MODE
</p>
<p>
;SAVE LINE CHAR
</p>
<p>
;OUTPUT LINE CHAR
</p>
<p>
;AND STRING CHAR TO BE COMPARED
</p>
<p>
CHKNOT:
</p>
<p>
CALL PVID
</p>
<p>
POP AF
</p>
<p>
ENDIF
</p>
<p>
CP {HL}
</p>
<p>
JR NZ, NXTCMP
</p>
<p>
SKPCMP: INC DE
</p>
<p>
NONTCH: LD A,1
LD HL,SWTCH 7A := (A) XOR (NSWTCH)
</p>
<p>
XOR (HL)
</p>
<p>
AND 1
</p>
<p>
JR NZ, FAIL
</p>
<p>
LD DE, OKMSG
</p>
<p>
JR REPORT
FAIL: LD DE, PROMSG
</p>
<p>
CALL MSG
</p>
<p>
LD C,RCONF
</p>
<p>
CALL FDOS
</p>
<p>
AND ODFH
</p>
<p>
cp oy?
</p>
<p>
JR 2, ABORT
</p>
<p>
CP o&rsquo;N&rsquo;
</p>
<p>
JR NZ,PAIL
</p>
<p>
LD DE, CONMSG
</p>
<p>
JR REPORT
ABORT: LD DE, SUBFCB
</p>
<p>
LD C,DELF
</p>
<p>
CALL FDOS
</p>
<p>
LD DE, DELFAL
</p>
<p>
INC A
</p>
<p>
JR Z,REPORT
</p>
<p>
LD DE, ABONSG
REPORT: CALL MSG
</p>
<p>
IF DEBUG
</p>
<p>
dP = WBOOT
</p>
<p>
ELSE
</p>
<p>
LD SP, (STK)
</p>
<p>
RET
</p>
<p>
ENDIF
</p>
<p>
DIGIT: INC HL
</p>
<p>
LDA, (HL)
DEC B
</p>
<p>
CP &lsquo;Gt+1
</p>
<p>
JR NC, REPORT
SUB &lsquo;0&rsquo;
</p>
<p>
JR C,REPORT
RET
</p>
<p>
;RESTORE LINE CHAR
</p>
<p>
; COMPARE CHARS
:IF NO MATCH
:BUMP DISPLAYED STRING @
</p>
<p>
ING HL ;BUMP CHECK STRING @
DJINZ COMP :IF MORE CHARS IN CHECK STRING
JR MATCH ; STRING MATCHES
NXTCMP: BIT SSWICH,(1X) ; CHECK START OF LINE SWITCH
JR NZ, NOMTCH&nbsp;,IF YES THEN NO MATCH
POP HL ; RESTORE START OF COMPARISON
POP DE
POP BC
INC DE ;STEP TO NEXT CHAR ON DISPLAY START COMPARE
DEC c ;COUNT DISPLAYED CHARS FULLY CHECKED
JR BEGCMP ;FOR NEXT ATTEMPT TO MATCH
MATCH: XOR A ;A = 0 FOR MATCH
JR CHKNOT
</p>
<p>
:A = 1 FOR NO MATCH
</p>
<p>
; IF SUBMIT DEEMED TO HAVE FAILED
;ELSE CONTINUE WITH SUBMIT
</p>
<p>
;PROMPT FOR ABORT
</p>
<p>
;READ CON:
</p>
<p>
;REMOVE CASE BIT
</p>
<p>
LIF YES
</p>
<p>
; IF NEITHER Y OR N ENTERED
</p>
<p>
;STILL CARRY ON
</p>
<p>
;DELETE SUBMIT FILE
</p>
<p>
:IF SUBMIT FILE NOT FOUND
;ABORTED SUBMIT
</p>
<p>
:REPORT OUTCOME
</p>
<p>
; WARM BOOT
</p>
<p>
:RETURN TO CCP
</p>
<p>
;PICK UP DIGIT FROM COMMAND LINE
; COUNT CHAR
; IF NOT DECIMAL DIGIT
</p>
<p>
/IF NOT DECIMAL DIGIT
;A = BINARY :
</p>
<?php columnEnd(2); ?>
