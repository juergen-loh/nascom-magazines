<?php columnStart(1); ?>
<p>
+
</p>
<p>
BASE
CENPAD
CENPBD
CENPACG
CENPBC
</p>
<p>
;
sINITIALISE THE
</p>
<p>
5
PRINT
</p>
<p>
START
</p>
<p>
EQU
EQU
EQU
&pound;QU
EQU
</p>
<p>
PUSH
PUSH
PUSH
PUSH
CALL
</p>
<p>
4a
BASE
BASE+1
BASE+2
BASE+3
</p>
<p>
PORTS, PORT B TO
</p>
<p>
BC
DE
HL
AF
INIT
</p>
<p>
sEXAMINE BUSY LINE TIL FREE
</p>
<p>
Loop
</p>
<p>
In
RRA
JR
</p>
<p>
A, (CENPAD)
</p>
<p>
C, LOOP
</p>
<p>
;PRINTER FREE SO SEND A CHAR
</p>
<p>
NOTESC
</p>
<p>
DONE
</p>
<p>
NOTLF
</p>
<p>
INIT
</p>
<p>
Poe
PUSH
cp
JR
LD
Our
NOP
LD
our
NOP
LD
our
POP
ce
JR
LD
IR
cP
JR
LD
POP
POP
POP
RET
LD
OUT
OUT
our
LD
OUT
LD
out
XOR
ouT
RET
END
</p>
<p>
ar
AF
</p>
<p>
4
NZ,NOTESC
A, 1BH
(CENPBD) ,A
</p>
<p>
A, OFOH
(CENPAD) ,A
</p>
<p>
A, OF FH
(CENPAD) ,A
AF
</p>
<p>
ODH
</p>
<p>
NZ, DONE
A, OAH
START
OAR
</p>
<p>
NZ, NOTLF
A, ODE
</p>
<p>
HL
</p>
<p>
DE
</p>
<p>
BC
</p>
<p>
A, OFFH
(CENPAD) ,A
(CENPBD),A
(CENPAC) ,A
A, OFDH
(CENPAC) ,A
A, OFFH
(CENPBC) ,A
A
</p>
<p>
(CENPBC) ,A
</p>
<p>
O/P,PORT A B.D
</p>
<p>
-
</p>
<p>
on ON on
</p>
<p>
on om om ae 8n on A en
</p>
<p>
oy
</p>
<p>
SAVE CHARACTER
</p>
<p>
Is it &ldquo;CTRL D&rdquo;
no
yes, output an &ldquo;escape&rdquo; code
</p>
<p>
da it end of line
no
yes, then output a lf char.
</p>
<p>
did we op a 1&pound;u
</p>
<p>
no
</p>
<p>
yes, put back cr for RET to main
routines
</p>
<p>
get back registers
</p>
<p>
set up PIO for centronics H/S
</p>
<p>
yee POLYDOS Overlay &ldquo;NPEH.OV&rdquo; ateaneee
REFS E&para; SYSEQU
</p>
<p>
REF
PRINT EQU 080078
;This Program is a POLYDOS file handler for
;NASPEN.This overlay allows text files to be
;loaded and dumped to disk via an extension
;program NASPEX. The extension program
;adds the disk facilities using the NASPEN
;commands &ldquo;W&rdquo; &amp; &ldquo;R&rdquo; .The cassette commands
;are retained by replacing the &ldquo;+&rdquo; &amp; &ldquo;=&rdquo;
;commands by &ldquo;r&rdquo; &amp; &ldquo;w&rdquo;. The extension file is
;leaded at B000H, and contains a printer driver
;for the Epson printer allowing some of the
;control codes to be output to the printer. This
;overlay initialises the printer on a cold start
</p>
<p>
ORG 0c8008
</p>
<p>
IDNT $,0 \
</p>
<p>
DB *NP&pound;h&rsquo;
</p>
<p>
LD DE, FNAME L
</p>
<p>
CALL D1
</p>
<p>
sPoint to filename string
3 load it into memory
LD DE, FNAME2 $ next string
CALL DL 3 load it
CALL PRINIT 3; Initialise EPSON RX80 printer
JP 0B 8008 3; Cold start NASPEN
gaeeeeRA DISK FILE LOADING ROUTINE *#e48ee
Di LD BL, S1FCB 3; Comments as POLYDOS manual
LD B, 1108
SCAL ZCFS
SCAL ZCKER
SCAL ZRDIR
SCAL ZCKER
SET 4,8
SET 5,8
SCAL ZLOOK
SCAL ZCKER
LD HL, (SLFCB4+FLDA)
LD DE, (SLFCB4+FSEC)
LD A, (SLFCB+FNSC)
LD B,A
SCAL ZDRD
SCAL ZCKER
RET
geekee PRINTER INITIALISATION **htdee
PRINIT LD HL, INITSG $ point to init. string
LD B, (HL) load length of init. string
Ine HL bump on pointer
P2 Lb A, (HL)
CALL PRINT 3; This routine is in the extention
INC aL 3 file just loaded
DINZ P2 3 loop til done
RET
;FILES TO BE LOADED BY OVERLAY ROUTINE
FNAMEL DB &ldquo;NASPEN.NP&rsquo; jMAIN NASPEN CODE
FNAME2 DB *NASPEX. GO&rsquo; sFILE WITH EXTENTIONS
INITSG DB OBH, IBH, 40H, BH, 43H, 42H, 1BH, 4EH, 6, 1BH
DB 6CH,8
END
</p>
<p>
Aan ee
</p>
<p>
21
</p>
<?php columnEnd(1); ?>
