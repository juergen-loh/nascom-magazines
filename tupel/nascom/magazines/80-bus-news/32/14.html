<?php columnStart(1); ?>
<p>
Part of Sysb4.Mac. Original code by Richard Beal.
Modified by Adrian Perkins l-Jan-1984 to support the following:
</p>
<p>
ajp002 &ndash; When at top of
</p>
<p>
page, &ldquo;throw away&rdquo; spurious CR, LF, CS
</p>
<p>
5
;
5; ajpQO1 &ndash; Perform page throw by form feeds, not CR,LF
;
3
</p>
<p>
ajp001 equ true
ajpQ02 equ true
</p>
<p>
if ttyes or Iptes
</p>
<p>
true for form feed, false for CR,LF
true for &ldquo;intelligence&rdquo;, false original lfi:
</p>
<p>
er ulles
</p>
<p>
Routine to support automatic form feed
</p>
<p>
;
</p>
<p>
} and perforation skip
if ajpoo2
</p>
<p>
top flag: defb 0
</p>
<p>
lhs flag: defb 0
</p>
<p>
5
3
</p>
<p>
0 = top-of-page, #0 = not at top
0 = at lhe of page, #0 = chars on this line
</p>
<p>
; Ignore CR, LF, CS if at top lhs
</p>
<p>
ekes: ld a,c
ep lf
jr z,ck top
ep er
dv a,ck top
ep cs
jr z,ck top
Id hl,lhs flag
r
1d (hl),1
jr ckesl
ck top: ld a,(top flag)
r
</p>
<p>
ora
jr nz,ckesl
ld a,(lhs flag)
: ow
or a
jr na,ckesl
pop hl
ret
</p>
<p>
ekesl: id a,c
else
</p>
<p>
ekes: ld a,c
endif
ep Lf
jr z,1fl
ep cs
ret nz
</p>
<p>
; Handle CS
pop hl
ld (lstel), hl
r
if ajpO0l &laquo;
jr skips
else
</p>
<p>
esi: ld a,(lent)
r
or a
jv z,skips
dec a
ld (lent),a
x
</p>
<p>
eall feed
r
jr esl
endify &ndash;
3; Handle line feed
if ajp002
LfL: id hl,top flag
r
</p>
<p>
id (h1),1
ld hl,ihs flag
</p>
<p>
r
ld (h1),0
pop hl
else
</p>
<p>
pop hi
endif
</p>
<p>
Id (lstel),hl ; Save return address
</p>
<p>
Get return address
</p>
<p>
Get return address
</p>
<p>
r
call feedl ; Do LF
</p>
<p>
r
ld hl,lent Decrement
</p>
<p>
rt
dec (hl)
ret nz
</p>
<p>
if ajp0ol
lid c,cs
endif
</p>
<p>
&laquo;+ line counter
Not at end of pag
</p>
<p>
ard
</p>
<p>
; Perforation skip
</p>
<p>
skips:
</p>
<p>
skips:
If NZ not at top
</p>
<p>
L8 NZ not at lhs skips]
Discard print address
</p>
<p>
ckesx:
</p>
<p>
Handle Line feed
Ignore {f not CS or LF
</p>
<p>
Get return address
Save return address
</p>
<p>
3 Send
feed:
</p>
<p>
Get line count
</p>
<p>
Perforation skip
Next Line
; Send
</p>
<p>
feadl:
Do CR/LF
</p>
<p>
feed2:
Loop until end of page
</p>
<p>
1f aj p002
ld hl,top flag
</p>
<p>
r
ld (n1),0
Id hl,lhs flag
</p>
<p>
r
</p>
<p>
ld (hl),0
</p>
<p>
else
</p>
<p>
ld a,(lekip) $ Lines to skip
r
</p>
<p>
or a ; Could be none
</p>
<p>
je z,ckesx
</p>
<p>
ld b,a
</p>
<p>
push be
</p>
<p>
call feed
</p>
<p>
e
</p>
<p>
pop be
</p>
<p>
djnz skipsl
</p>
<p>
endif
</p>
<p>
Id a,(plpag) 5 Reset line counter
</p>
<p>
rc
ld (lent),a
</p>
<p>
r
</p>
<p>
Lf ajp002
</p>
<p>
jr feed2
</p>
<p>
else
</p>
<p>
ret
</p>
<p>
endif
</p>
<p>
CR/LF through the calling routine
ld c,er
</p>
<p>
id hl, feedl 3 Return address
</p>
<p>
r
push hl
id hl, (istel) ; Caller address
</p>
<p>
r
</p>
<p>
jp (hi)
</p>
<p>
LF through the calling routine
ld c,1lf
if ajp0d2
</p>
<p>
endif
ld hl, (istel) 3 Caller address
</p>
<p>
r
je (hl)
endif
</p>
<p>
i
\
</p>
<p>
14
</p>
<p>
4
&lsquo;
</p>
<?php columnEnd(1); ?>
