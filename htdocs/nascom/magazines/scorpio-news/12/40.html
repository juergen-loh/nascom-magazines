<?php columnStart(23); ?>
<h2 id="article1">
Disk Formats and CP/M Disk routines&nbsp;&ndash; Part 2
</h2>
<?php columnChange(3); ?>
<h3 class="author" style="text-align: right">
by M.W.T. Waters
</h3>
<?php columnEnd(3); ?>
<?php columnStart(1); ?>
<h4>
Part 2.
</h4>
<h3>
File sizes, disk sizes and directories
</h3>
<p>
Having well and truly taken a disk to pieces in Scorpio News V1 I1, we can at
last return to CP/M and the questions asked at the beginning of the
<a href="../../../11/25/text/#article1">first part of this article</a>
(Can anyone remember what they were?)
</p>
<p>
Minimum file size on disk is determined by the block size (referred to by
Digital Research as BLS). CP/M stores files on disk as one or more blocks of
information, where each block may contain 8, 16, 32, 64 or 128 CP/M records (128
bytes long) depending upon the block size. Blocks may be 1K, 2K, 4K, 8K or 16K
bytes long, chosen (usually) by the computer manufacturer when deciding upon
disk size and format. As an example, there are four commonly used Gemini
formats available. The SDDS format uses 1K block size, the DDDS format uses a
2K block size while the QDDS and QDSS formats use 4K block size. The blocks
are sometimes referred to as allocation units since disk space is allocated to
files as one or more blocks.
</p>
<p>
The minimum size of a CP/M file is one block. If you imagine that you wish to
save a short utility program of, say, 128 byes to disk, that program will
appear to be 1K long on a system with a 1K block size or 16K long with a 16K
block size. On a system with a 16K block size, there would be 16256 bytes of
disk apace wasted after the file was written to disk. Why then do
manufacturers, such as Gemini, use larger block sizes? At first sight, it would
appear that a 1K block size is the best choice all round. As we shall see
later, the problem of which block size to use isn&rsquo;t quite that simple otherwise
all manufacturers would have used 1K blocks (wouldn&rsquo;t they?)
</p>
<p>
What then, determines the maximum size of a file or disk? To quote Digital
Research, CP/M 1.4 allows a maximum disk size and file size of 256Kbytes. The
maximum disk size may be extended by the use of double density but the process
is cumbersome and wasteful of directory space. For this reason, few computer
manufacturers appear to have made double density CP/M&nbsp;1.4 systems.
</p>
<p>
CP/M&nbsp;2.2 allows a maximum disk size and file of 8MBytes. The reason for
this is that a maximum of 65536 records of 128 bytes each may be written to a
disk or file. The maximum file size is determined by the maximum value for the
random record field of a CP/M&nbsp;2.2 file control block which may range from 0 to
65535.
</p>
<p>
Under CP/M&nbsp;3 (CP/M Plus), the maximum disk size allowed is 512Mbytes made up of
a maximum of 32768 blocks. This of course assumes a 16K block size; smaller
block sizes reduce the maximum disk size accordingly so that with a 1K block
size, the theoretical maximum disk sise is 32Mbytes. In practice, the maximum
number of 1K blocks under CP/M&nbsp;2.2 or CP/M&nbsp;3 is 256. This is to provide
compatibility with CP/M&nbsp;1.4 disks as we shall see later. The maximum file size
allowed by CP/M&nbsp;3 is 32Mbytes and is determined again by the maximum value for
the random record field of the CP/M&nbsp;3 file control block which may range from 0
to 262143 giving 262144 records of 128 bytes each per file. To accommodate this
higher figure, the lower 2 bits of the R2 byte of the FCB are now used to give
an 18 bit random record number.
</p>
<p>
At this point, we need to see how directory information is stored on a disk.
For those familiar with DU.COM, this may appear to be revision but don&rsquo;t skip
this section too quickly as a couple of surprises may be in store for you.
</p>
<p>
A CP/M&nbsp;2.2 directory entry on disk looks something like the example given below.
The format used to show the entry is &ldquo;borrowed&rdquo; from DU.COM.
</p>
<?php imageCenter($imagepath, $magpath, $issuepath, $pagepath, "Image-40-1.png"); ?>
<?php columnEnd(1); ?>
