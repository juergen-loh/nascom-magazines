<?php columnStart(1); ?>
<p>
3 MOVDY1: LD DE, STRING s;POINT DE TO PLACE IN &ldquo;STRING&rdquo; FOR
sef R ;THE DAY NAME TO BE INSERTED
ret LDIR sMOVE THE 3 BYTES
</p>
<p>
; INC DE ;SPACE BETWEEN DAY NAME AND DATE
endif 5END OF ORIG, SYS I.V.C. ROUTINE ENDIF
</p>
<p>
IF CLOCK sEXTRA CODE TO READ AND DISPLAY CLOCK&nbsp;, IF NKBD ;START OF DATE AND TIME STRING
</p>
<p>
LD DE,STRNGI 3IN CASE DAY NAME NOT PROCESSED
MAY BE CALLED FROM EXTERNAL PROGRAMS VIA JUMP TABLE. RETURNS WITH HL R
</p>
<p>
POINTING TO CLOCK DATA. ENDIF
</p>
<p>
EADIT: LD C,RTC+ ;CLOCK PORT 1 ADDRESS INTO -C* LD HL, REGS+7 sPOINTER TO TENS OF DAY OF MONTH
LD B, NMRREG ;NUMBER OF REGISTERS TO READ R
LD HL, REGS ;POINTER TO MEMORY STORE LD
</p>
<p>
32 BLOCKS TO MOVE (MONTHS AND DAYS)
R MOVTIM: LD
</p>
<p>
3 MOVIMI: LD &raquo; (HL) ;GET BYTE FROM REGS.
RDT1: INC c ;LOOP AND READ THEM INTO MEMORY LD E),A ;MOVE IT TO STRING
</p>
<p>
INI INC DE ;BUMP DESTINATION
5 JR NZ,RDT1 DEC HL ;REDUCE SOURCE POINTER
</p>
<p>
, DINZ MOVTM1 ;LOOP FOR 2 BYTES EACH TIME
5 LD B, NMRREG ;NOW SCAN THEM ALL IN TURN AND IF TNC DE 3SKIP OVER -/* CHAR.
</p>
<p>
LD HL,REGS ;ANY ARE&nbsp;?FH, CLOCK WAS UPDATING, LD HL, REGS+10 sPOINTER TO TENS OF MONTHS
R 380 READ &ldquo;EM ALL AGAIN R
</p>
<p>
; DEC c ;IF -C&rdquo; NOT ZERO, MONTHS NOT YET
SCAN: LD A, CHL) JR NZ&nbsp;,MOVTIM ;COPIED TO THE STRING
AND OFH INC DE sMOVE PAST TENS OF YEAR
cp OFH INC DE ;DITTO &ndash; UNITS
JR Z,READIT INC DE ;NOW SKIP THE SPACE BETWEEN DATE &amp; TIME
</p>
<p>
; LD HL, REGS+5 ;POINTER TO TENS OF HOURS
ADD A, 30H 3AS EACH VALUE VERIFIED, MAKE ASCII R
</p>
<p>
LD (HL) A 3AND PUT BACK INTO MEMORY STORE LD c,3 s;HOURS, MINS., &amp; SECS. TO MOVE
INC HL MOVIM2: LD B,2 32 BYTES TO MOVE EACH TIME ROUND
DINZ SCAN MOVIM3: LD A, CHL) 3;SAME AS ABOVE
</p>
<p>
LD (DE) ,A
TORE NOW HOLDS VALID ASCII DATA SO PUT IT INTO A STRING BUFFER FOR SCREEN INC DE
</p>
<p>
s
DISPLAY, STARTING WITH DAY NAME IF SUFFICIENT SPACE FOR THE CODE. DEC HL
</p>
<p>
DINZ MOVIM3
IF NOT NKBD INC DE
</p>
<p>
: DEC c
MOVDAY: LD DE, DAYO ;POINT TO FIRST DAY NAME DATA. THIS JR NZ, MOVIM2
R 31S BLANK IN CASE ERROR IN CLOCK 0/P 3
LD BC,3 33 CHARS FOR EACH NAME ;CLOCK DATA NOW IN STRING/STRNG1, SO MOVE CURSOR AND PRINT IT
LD A, (REGS+8) ;GET DAY OF WEEK DATA :
R CSRSAV: LD HL, (CURSOR) ;SAVE EXISTING CONTENTS OF -CURSOR-
AND OFH ;REMOVE -ASCII&rsquo; PART R ;IN CASE THEY ARE RELEVANT
cP 8 PUSH AL
Je P,MOVDYL ;IF &gt;7, ERROR SO PRINT BLANK NAME CALL &ndash; SAVCUR ;NOW SAVE CURRENT POSITION IN &ldquo;CURSOR&rsquo;
R R
LD HL, 0000 ;ELSE MULT. DATA BY 3 ;
LD LA ; AND ADD TO DAYO POINTER SO AS TO CSROFF: LD A, O1BH
ADD A,L ;POINT TO CORRECT DAY NAME CALL &mdash;- CRTX
ADD A,L
LD LA LD A,"D&rdquo;
ADD HL, DE 3HL NOW POINTS TO CORRECT NAME CALL &mdash;-CRTX
</p>
<p>
or
-_
</p>
<p>
an en en on
</p>
<p>
;TURN OFF CURSOR WHILE PRINTING CLOCK
</p>
<?php columnEnd(1); ?>
