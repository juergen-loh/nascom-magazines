<?php columnStart(1); ?>
<p>
out (c),a
dec c
</p>
<p>
nop
</p>
<p>
out (Cc) ,b
out Ce) ,d
out Ce) ,b
im 2
</p>
<p>
et
</p>
<p>
reti
</p>
<p>
List status
</p>
<p>
FF if ready
</p>
<p>
eentst: ld hl,lstin
ld a,(hl)
ine hh
sub Chil)
ine a
ret Zz
1d a, OFFH
ret
3; List output
3; on entry C = character
centro: call centst
or a
je z,centro
jd hi&nbsp;,lstin
push hl
ld a,(hl)
ine hl
ine AL
add a,l
ld l,a
jr ne,centrl
ine h
centri: ld Chl) ,c
pop hL
ine Chi)
id a,(pport)
add a, 02
ld e,a
ld a,83H
out Ce),a
</p>
<p>
Intercupt service routine
</p>
<p>
os
</p>
<p>
wt
</p>
<p>
a
</p>
<p>
c
</p>
<p>
rt
</p>
<p>
vu
</p>
<p>
4
ene
</p>
<p>
Cusersp) ,sp
ld sp,iststk
push af
</p>
<p>
push hl
</p>
<p>
push be
</p>
<p>
on exit A= 00 if not ready
</p>
<p>
;Output null
</p>
<p>
;PIO port A data (strobe/busy)
ssettle
</p>
<p>
;Strobe high
</p>
<p>
;Strobe low
</p>
<p>
;8trobe high
</p>
<p>
;Interrupt mode 2
</p>
<p>
;Enable interrupts
</p>
<p>
;Clear spurious interrupts
</p>
<p>
sLf input pointer &ndash; output pointer
</p>
<p>
sis -1 CFF) then buffer is full
3(1.e. not ready)
;Otherwise return ready
</p>
<p>
Wait for ready
</p>
<p>
3
&gt;
;Get input pointer
</p>
<p>
s;save Input pointer address
&gt;
</p>
<p>
;Get buffer address
</p>
<p>
;Get next address in buffer
</p>
<p>
&gt;
</p>
<p>
,
</p>
<p>
;
;Store character there
seetrlLeve input pointer address
s;Increment input pointer
</p>
<p>
;Get port address
</p>
<p>
3PIO A control
</p>
<p>
sEnable PIO A interrupts
</p>
<p>
3
</p>
<p>
;Done
</p>
<p>
jsave user SP
suse own stack
;Save regs
</p>
<p>
,
,
</p>
<p>
intl:
</p>
<p>
int2:
</p>
<p>
ld
out
dec
out
dec
ld
out
ld
out
pop
pop
pop
1d
et
reti
</p>
<p>
equ
equ
</p>
<p>
defb
defb
</p>
<p>
program
</p>
<p>
eall
Ld
ld
inc
or
ret
ld
push
call
pop
jr
</p>
<p>
end
</p>
<p>
hl&nbsp;,lstout
a,(hl)
(hl)
</p>
<p>
hl
</p>
<p>
a,l
</p>
<p>
l,a
ne,intl
h
</p>
<p>
b, (hl)
a,(pport)
a,02
</p>
<p>
c,a
hl,ilstin
a,Chl)
</p>
<p>
hl
</p>
<p>
Chl)
nz,int2
a,0O3H
</p>
<p>
Cc) ,a
</p>
<p>
c
</p>
<p>
(e),b
</p>
<p>
c
</p>
<p>
a, OFDH
(c),a
</p>
<p>
a, OFFH
(cc),a
</p>
<p>
be
</p>
<p>
hl
</p>
<p>
af
sp,(usersp)
</p>
<p>
ODH
OAH
</p>
<p>
sOQutput pointer
</p>
<p>
;Get output pointer
</p>
<p>
;Point to next
</p>
<p>
3Get buffer address
</p>
<p>
;Get address of output characte
</p>
<p>
3;Get output character
3;Get port address
s;PIO A control
</p>
<p>
;Get pointer address
</p>
<p>
If input pointer = output pointer
</p>
<p>
sthen buffer is empty
;Not empty
;Disable PIO A interrupts
</p>
<p>
3PIO A data
</p>
<p>
;Output character
</p>
<p>
;PLO A data (strobe/<?php spChar("zwsp"); ?>busy)
Strobe low
</p>
<p>
Strobe high
</p>
<p>
Restore regs
</p>
<p>
s;cestore user SP
;Re-enable interrupts
sReturn from interrupt
</p>
<p>
&ldquo;This is a test message&rdquo; ,CR,LF
&ldquo;Test finished&rdquo; ,CR,LF,O
</p>
<p>
init
RL text
a,(hl)
hl
</p>
<p>
a
</p>
<p>
Z
</p>
<p>
c,a
</p>
<p>
hl
centro
hl
loop
</p>
<p>
start
</p>
<p>
sPerform initialisation
</p>
<p>
;Output text string terminated by null
</p>
<p>
Note HL destroyed by centro
</p>
<p>
40
</p>
<?php columnEnd(1); ?>
