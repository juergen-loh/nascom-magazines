<?php columnStart(1); ?>
<p>
.
%
</p>
<p>
term4: and 7fh
</p>
<p>
termfa: cp cr
</p>
<p>
+
</p>
<p>
Output to console
</p>
<p>
Strip parity
ep bs If BS make CUL
jr nz,termd4a
</p>
<p>
1d a,cul
</p>
<p>
jr term5
</p>
<p>
Ok if CR
</p>
<p>
jr z,term5
ep if
</p>
<p>
jr 2,term5
ep bell
jr z2,term5
ep 20h
</p>
<p>
jr c,term2
ep 7fh
</p>
<p>
je a,term?
</p>
<p>
OK if LF
</p>
<p>
-
</p>
<p>
OK if Bell
</p>
<p>
--
</p>
<p>
Output to display
</p>
<p>
term5: 1d e,a ; Save for printing
</p>
<p>
.
,
</p>
<p>
push de
call vdu
pop de
</p>
<p>
Print
ld a, (sprt)
ora
call nz,print
</p>
<p>
Test toggle
</p>
<p>
Test keyboard
</p>
<p>
term6: call keyin
</p>
<p>
,
</p>
<p>
or a
jr z,term2
</p>
<p>
ld hl, chex
</p>
<p>
ep (hl)
</p>
<p>
dp 2,Jjwboot
1d hl,chpr ; Toggle printer
ep (hl)
</p>
<p>
jr na,termio
ld a,(sprt)
</p>
<p>
epl
</p>
<p>
ld (sprt),a
</p>
<p>
iv term2
</p>
<p>
No input
</p>
<p>
Exit to CP/M
</p>
<p>
Output to UART
</p>
<p>
term10O: call serout
</p>
<p>
&lsquo;
</p>
<p>
To display if half duplex
ld c,a
ld a, (param)
ep cs H&rdquo;
jr nz, term2
ld a,e
jr term4
</p>
<p>
Otherwise ignore non-printing chars
</p>
<p>
3; I/O routines
</p>
<p>
3; Check keyboard
</p>
<p>
keyin:
</p>
<p>
key2:
</p>
<p>
ld a,Offh ;
1d (vbusy),a
</p>
<p>
ld e,esc 3
eall vdu
</p>
<p>
ld e,"k&rdquo;
call vdu
call getive
ora
</p>
<p>
jr z,key2
ld e,ese
call vdu
</p>
<p>
ld e,"K&rdquo;
call vdu
call getive
push af
xor a ;
ld (vbusy),a
</p>
<p>
pop af
</p>
<p>
ret
</p>
<p>
oe on
</p>
<p>
Flag VDU busy
</p>
<p>
Check if char entered
</p>
<p>
No input
Get character
</p>
<p>
Flag VDU normal
</p>
<p>
3 Get character from the TVC
getive: call serin ;
</p>
<p>
in a, (pvdus)
rla
jr c,getive
in a, (pvdud)
ret
</p>
<p>
Sean for serial input
</p>
<p>
3; Send character in E to IVC
</p>
<p>
vdu:
</p>
<p>
3; Print
</p>
<p>
print:
</p>
<p>
spe:
sp4:
</p>
<p>
push de
call serin
pop de
</p>
<p>
in a, (pvdus) ;
rra
</p>
<p>
jr c,vdu
</p>
<p>
ld a,e
</p>
<p>
out (pvdud),a ss;
ret
</p>
<p>
on
</p>
<p>
character in E
if cpml
</p>
<p>
ld c,list
</p>
<p>
dp jbdos
</p>
<p>
else
</p>
<p>
ld a,e
</p>
<p>
ora
</p>
<p>
ip pe,sp2
</p>
<p>
xor 80h
</p>
<p>
push af
</p>
<p>
call serin ;
in a, (puarts)
</p>
<p>
if p8250
</p>
<p>
bit 5,a
</p>
<p>
else
</p>
<p>
bit 6a |
</p>
<p>
Sean for serial input
</p>
<p>
Check status
</p>
<p>
Output character
</p>
<p>
Output to CP/M list device
</p>
<p>
Output to serial printer
</p>
<p>
Make even parity
</p>
<p>
Sean for serial input
</p>
<p>
42
</p>
<?php columnEnd(1); ?>
