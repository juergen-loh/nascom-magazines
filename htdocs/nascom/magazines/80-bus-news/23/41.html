<?php columnStart(1); ?>
<p>
we en em em ew
</p>
<p>
wm Oe em ae en em om oe
</p>
<p>
a-vee-- Start of program listing -----
</p>
<p>
page 60
</p>
<p>
title TERMB Buffered Terminal Program
</p>
<p>
+280
Program for a simple half or full duplex terminal.
Operates at slow and fast speeds. Tested at up to 9600 bps.
Execute with command TERM H for half duplex, otherwise it is full duplex.
Type Control-C to exit to CP/M. Patch 0103H to change this character.
Type Control-P to toggle printer. Patch 0104H to change this character.
</p>
<p>
Configuration is Gemini IVC for display and keyboard.
</p>
<p>
The UART is an 8250, or a 6402.
</p>
<p>
The printer may be either the CP/M list device, or a serial printer
which may have an 8250 or 6402 UART.
</p>
<p>
If the printer is the CP/M list device, then this must be fast enough
to keep up with the input data.
</p>
<p>
Code could be added for a Centronics printer, scanning for serial input
while waiting for the printer to be ready.
</p>
<p>
false equ 0
true equ not false
</p>
<p>
.
&lsquo;
</p>
<p>
u8250 equ false
</p>
<p>
UART type &ndash; 8250 if true, 6402 if false
UART to host/modem
</p>
<p>
5
p8250 = equ false ; UART for serial printer, if selected
</p>
<p>
&lsquo;
Y
</p>
<p>
Printer type &ndash; CP/M list device if true, serial printer if false
</p>
<p>
epml equ false
</p>
<p>
,
</p>
<p>
Ports for UART to host/modem
if u8250
</p>
<p>
uartd equ Obd8h 3 Data
;
</p>
<p>
uarts equ uartd+5
</p>
<p>
uartd equ ith
uarts equ uartd+{
</p>
<p>
:
&lsquo;
</p>
<p>
puartd equ ObSh
</p>
<p>
Status
else
</p>
<p>
Data
Status
</p>
<p>
3
</p>
<p>
3
endif
</p>
<p>
Ports for serial printer
</p>
<p>
if p8250
Data
</p>
<p>
$
puarts equ puartd+5 3; Status
</p>
<p>
puartd equ Oth
puarts equ puartd+{
</p>
<p>
+
</p>
<p>
else
</p>
<p>
Data
Status
endif
</p>
<p>
Ports for IVC
</p>
<p>
pyvdud equ Obth 3; Data
:
</p>
<p>
pyvdus equ Ob2h
</p>
<p>
:
&lsquo;
</p>
<p>
ichex equ conc
</p>
<p>
Status
</p>
<p>
Keyboard command characters
Exit to CP/M
</p>
<p>
5
ichpr equ conp 3; Toggle printer
</p>
<p>
*
?
</p>
<p>
li
</p>
<p>
condir equ 6
jwboot equ 0000h
Jbdos equ 0005h
</p>
<p>
f1
</p>
<p>
&lsquo;
co
</p>
<p>
bell equ O7h
</p>
<p>
bs
</p>
<p>
lf equ Oah
er equ Odh
</p>
<p>
co.
es
</p>
<p>
cul equ ich
</p>
<p>
.
y
</p>
<p>
chex: defb ichex
chpr: defb ichpr
</p>
<p>
ab
ob
sp
</p>
<p>
param: defb 0
vbusy: defb 0
</p>
<p>
st.
</p>
<p>
y
</p>
<p>
st
</p>
<p>
:
&lsquo;
</p>
<p>
.
,
</p>
<p>
*
5
</p>
<p>
te
</p>
<p>
.
$
</p>
<p>
te
</p>
<p>
te
</p>
<p>
CP/M routines
st equ 5 List output
</p>
<p>
Direct console I/O
Warm boot
</p>
<p>
CP/M
</p>
<p>
Parameters
</p>
<p>
om ne ee an am
</p>
<p>
equ 005dh
</p>
<p>
Characters
</p>
<p>
ne equ O3h Control-c
</p>
<p>
Bell
</p>
<p>
Backspace
</p>
<p>
Line feed
Carriage return
Control-P
Escape
</p>
<p>
Cursor left
</p>
<p>
equ O8h
</p>
<p>
np equ 10h
e equ tbh
</p>
<p>
oe a
</p>
<p>
Working storage
</p>
<p>
Exit to CP/M &ndash; can patch this value
Toggle printer &ndash; can patch this value
Input position in buffer
</p>
<p>
Output position in buffer
</p>
<p>
Printer toggle &ndash; 0 to not print
</p>
<p>
H for half duplex, otherwise full duplex
</p>
<p>
FF when VDU is busy answering keyboard request
Stack
</p>
<p>
uf: defw buffer
uf: defw buffer
rt: defb 0
</p>
<p>
see ER ee em em en ee
</p>
<p>
defs 32
ack:
</p>
<p>
Start
art: 1d sp,stack
</p>
<p>
Load parameter entered in command line
ld a,(f1)
1d (param),a
</p>
<p>
Start of main processing loop
</p>
<p>
Sean for serial input
rm2: call serin
</p>
<p>
Examine buffer
rm3: 1d hl, (abut)
ld de, (obuf)
ora
sbe hl,de
jr nz,term3a
1d hl, buffer ; Empty, so reset buffer
ld (abuf),hi
ld (obuf),hl
jr term6
rm3a: 1d a, (de) ; Get char from buffer
inc de
ld (obuf),de
</p>
<p>
41
</p>
<?php columnEnd(1); ?>
