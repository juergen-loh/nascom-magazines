<?php columnStart(1); ?>
<p>
by Olav
</p>
<p>
Bergen,
Nov.27,
</p>
<p>
NAS-SYS&nbsp;3 modifications
</p>
<p>
Lerflaten.
Norway
1983
</p>
<p>
ORG &pound;0005
JP PRINIT
</p>
<p>
ORG &pound;00B6
LD D, &pound;7
</p>
<p>
ORG &pound;012F
ce &ldquo;]+1
</p>
<p>
ORG &pound;0145
JR &pound;0155
</p>
<p>
3;Rest of PRARGS code
</p>
<p>
CONTUE
</p>
<p>
NXTARG
</p>
<p>
RET Z
</p>
<p>
LD B,A
</p>
<p>
LD HL, &pound;0C0C
LD A, (HL)
SCAL &ldquo;L
</p>
<p>
INC HL
</p>
<p>
INC HL
</p>
<p>
DJNZ NXTARG
RET
</p>
<p>
DEFB 0
</p>
<p>
ORG &pound;0183
JP DRIVER
</p>
<p>
ORG &pound;0408
</p>
<p>
;Link PIO init routine
</p>
<p>
;Change kbd mask (@ repeating)
</p>
<p>
;Support lower case [ \ ]
</p>
<p>
3@ as CTRL key not supported
</p>
<p>
sReturn if no arguments
;No. of arge in B reg.
sARGI
</p>
<p>
sArg in A reg.
</p>
<p>
;Output arg to printer
</p>
<p>
sHL points to next arg
;Cont until no more args
3End of PRARGS
</p>
<p>
;Fill
</p>
<p>
;Workspace init $UOUT
</p>
<p>
DEFM /* NAS-SYS&nbsp;3.1 */ :New commercial
</p>
<p>
ORG &pound;04A9
</p>
<p>
s;Shortened PREGS routine
</p>
<p>
PREGS
</p>
<p>
3PI0 initialization routine
</p>
<p>
PRINIT
</p>
<p>
RST &pound;28
</p>
<p>
DEFB &pound;18
DEFM /PC=/
DEFB O
</p>
<p>
LD HL, (&pound;0C69)
SCAL &pound;66
</p>
<p>
SCAL &pound;6A
</p>
<p>
RET
</p>
<p>
LD A, EEF
OUT (6),A
XOR A
OUT (6),A
DEC A
</p>
<p>
3 PRS :
;CCR
</p>
<p>
;HL=(PC) before brkpt
3; TBCD3
</p>
<p>
sCRLF
</p>
<p>
3End of PREGS routine
</p>
<p>
OUT (7),A
DEC A
OUT (7),A
LD A,
OUT (5),A
JP &pound;03FE
</p>
<p>
sPrinter driver routine
</p>
<p>
DRIVER
BUSY
</p>
<p>
NOCHG
</p>
<p>
FIN
</p>
<p>
yStart of
PRARGS
</p>
<p>
PUSH AF
IN A,(5)
AND &pound;04
</p>
<p>
JR NZ, BUSY
POP AF
</p>
<p>
PUSH AF
</p>
<p>
CP &pound;0A
</p>
<p>
JR 2,FIN
</p>
<p>
cP &pound;0D
</p>
<p>
JR NZ,NOCHG
suB 3
</p>
<p>
OUT (4),A
XOR A
</p>
<p>
our (5),A
INC A
</p>
<p>
OUT (5),A
POP AF
</p>
<p>
RET
</p>
<p>
;STROBE line high
sjump to MRET
</p>
<p>
3Save AF
</p>
<p>
jLine B2 high Lf busy
; Mask
</p>
<p>
y?ry again if busy
sData restored in A
</p>
<p>
sIs it LF&nbsp;?
</p>
<p>
sIf so, ignore
</p>
<p>
sie it CR?
</p>
<p>
y1f not so, don&rsquo;t modify
sMake a LF from the CR
;Data to printer
</p>
<p>
sStrobe low
sStrobe high again
</p>
<p>
Restore AF before return
sEnd of printer driver
</p>
<p>
NAS-SYS F command
</p>
<p>
LD A, (&pound;0C0B)
OR A
JP CONTUE
</p>
<p>
s;ARGN workep loc
;Set 2 flag if no arguments
sContinue elsewhere
</p>
<p>
;Changes to the keyboard table
</p>
<p>
ORG &pound;0504
DEFB &pound;FF
</p>
<p>
ORG &pound;05D1
DEFB &pound;FF
</p>
<p>
ORG &pound;0616
DEFB &pound;0E
</p>
<p>
ORG &pound;0619
DEFB &pound;8D
</p>
<p>
;No LF on LF key
</p>
<p>
sNo CH on CH key
</p>
<p>
;CH/LF key gives &ldquo;\&rdquo; and &ldquo;|&rdquo;
</p>
<p>
sShife/@ gives " &ldquo; char
</p>
<p>
;Changes in subroutine table
</p>
<p>
ORG &pound;078C
DEFW &pound;04E8
</p>
<p>
ORG &pound;0798
DEFW &pound;04CB
</p>
<p>
3F command, args to printer
</p>
<p>
3L command, printer driver
</p>
<p>
NEHOAORANY
</p>
<p>
</p>
<?php columnEnd(1); ?>
