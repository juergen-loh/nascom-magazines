<?php columnStart(1); ?>
<p>
20
</p>
<p>
Note: Example 3 has used Microsoft&rsquo;s MBASIC in a CP/M environment. Other versions
of Basic may be used in a similar way, but the syntax may need adjusting to suit.
(eg The Nascom version of Basic supports only a single USR function which is
accessed ina slightly different way). The same technique may be employed in other
langauges, the exact approach to take depending upon the way the language executes.
If there is a poll of the keyboard inbetween statements (as in the Basic
interpreter), then the machine code subroutine approach will be necessary,
otherwise the direct port access (WAIT/INP etc) can be used satisfactorily.
</p>
<p>
EXAMPLE 4 &ndash; &ldquo;SINGLE SHOT&rdquo; OPERATION
</p>
<p>
This example is in fact an extension to example 3, and uses the ESC L and ESC U
commands to provide a &ldquo;single shot&rdquo; operation of the light pen switch. This is done
by downloading a very short program to the IVC and calling it before requesting
(or after reading) the light pen coordinates. What the routine does to sit ina
loop until the switch on the light pen is released, and so the switch has to be
released before another pair of coordinates can be read.
</p>
<p>
Subroutine for the USER area of the IVC card.
</p>
<p>
This subroutine does nothing other than sit in a loop
if the light pen switch is found to be operated.
</p>
<p>
The code will be loaded to the user area at O&amp;400H
put it is position independent anyway.
</p>
<p>
we we we we we
</p>
<p>
LPENSW EQU 4 ;Bit number of LPEN switch on status port
USER: BXX :Get the alternate register set
LPENW: BIT LPENSW, (HL) ;Is the switch operated?
</p>
<p>
JR Z, LPENW 3Yes, loop
</p>
<p>
EXX *No, reset registers
</p>
<p>
RET y..and return
</p>
<p>
END
</p>
<p>
3000 REM KKK EE EEE REAR ESE LEIANLA AIA ANAELIAAAREEAEOES
</p>
<p>
3001 REM Subroutine to set up a &ldquo;User&rdquo; command on the IVC
ZOO2 REM #X#RRELERAR AREER REALE ERE RE KLARA NEE REL ER ERE LER ERE
</p>
<p>
3010 U$="&rdquo; :REM Clear US$
</p>
<p>
3010 FOR I=1 to 11 :REM 11 bytes to send
</p>
<p>
3020 READ B sREM Read a byte
</p>
<p>
4030 U$S=U$+CHRS$(B) :REM Add to string
</p>
<p>
3050 NEXT I
</p>
<p>
3060 PRINT U$;"ESC U now set up&rdquo; :REM Set command and say so
3070 RETURN
</p>
<p>
3080 REM &ldquo;HSC&rdquo; &ldquo;L&rdquo; 7 0 +machine code routine
3090 DATA 27,76,7,0, 217,203, 102,40, 252,217,201
</p>
<p>
Try adding the above subroutine to the code of example 3. Also include
125 GOSUB 3000
</p>
<p>
2015 PRINT CHR$(27);"U&rdquo;; :REM Do ESC U. (ie Hang up until
he/she lifts his/her finger).
</p>
<p>
These are only suggestions &ndash; take and develop as you see fit.
</p>
<?php columnEnd(1); ?>
