<?php columnStart(1); ?>
<p>
AmoOSt1A
</p>
<p>
Tabte 1.
</p>
<p>
Command
Mnemonic
</p>
<p>
Hex Code
{se = 1)
</p>
<p>
Summary
</p>
<p>
Hex Code
Description
</p>
<p>
Execution
{or = 0)
</p>
<p>
Cycles
</p>
<p>
16-BIT FIXED-POINT OPERATIONS
</p>
<p>
SADD
SSUB
SMUL
SMUU
Sov
</p>
<p>
2agea
</p>
<p>
16-18 Add TOS to NOS. Result to NOS. Pop Stack.
</p>
<p>
30-32 Subtract TOS from NOS. Result to NOS. Pop Stack,
Multiply NOS by TOS. Lower rasult to NOS. Pop Stack.
80-98 Multply NOS by TOS. Upper result to NOS. Pop Stack.
84-94 Divide NOS by TOS. Resuit to NOS. Pop Stack.
</p>
<p>
3
3
Z38ers
</p>
<p>
32-BIT FIXED-POINT OPERATIONS.
</p>
<p>
QVBI2R%
</p>
<p>
2c 20-22 Add TOS to NOS. Result to NOS. Pop Stack
</p>
<p>
20 938-40 Subtract TOS trom NOS. Resuit to NOS. Pop Stack.
26 194-219 Mutuply NOS by TOS. Lower result to NOS. Pop Stack.
36 482-218 Multiply NOS by TOS. Upper result 1a NOS Pop Stack.
2F 196-210 Divide NOS by TOS. Result to NOS Pop Stack.
</p>
<p>
32-BIT FLOATING-POINT PRIMARY OPERATIONS
</p>
<p>
SaRB
</p>
<p>
10 54-368
44 70-370
12 146-168
13 184-184
</p>
<p>
Add TOS to NOS. Result to NOS. Pop Stack.
Subtract TOS from NOS. Result to NOS. Pop Stack.
Multiply NOS by TOS. Result to NOS Pop Stack
Divide NOS by TOS. Result te NOS. Pop Stack.
</p>
<p>
32-BIT FLOATING-POINT DERIVED OPERATIONS
</p>
<p>
aACOS
</p>
<p>
29838852833
</p>
<p>
782-870
3796-4808
</p>
<p>
Square Root of TOS. Result to TOS.
Sine of TOS. Result to TOS.
</p>
<p>
3840-4878
4894-5886
6230-7998
6304-8286
4992-6536
4474-7132
4298-6956
</p>
<p>
Cosine of TOS. Result to TOS.
</p>
<p>
Tangent of TOS. Result to TOS
</p>
<p>
inverse Sine of TOS. Result to TOS.
</p>
<p>
inverse Cosine of TOS. Result to TOS
</p>
<p>
inverse Tangent of TOS. Result to TOS.
</p>
<p>
Common Loganthm of TOS. Result to TOS
</p>
<p>
Natural Logarithm of TOS. Resull to TOS
</p>
<p>
3794-4878 @ thised to power in TOS. Reauit to TOS
</p>
<p>
8290-12082 NOS raised to power in TOS. Result to NOS. Pop Stack
</p>
<p>
ags83ae8se88s8
</p>
<p>
DATA AND STACK MANIPULATION OPERATIONS
</p>
<p>
XCHS
xcHo
XCHF
</p>
<p>
BQEYRLTARKRESERREBRS
</p>
<p>
00 4 No Operation. Clear or set SVREQ.
1F 90-214
</p>
<p>
18 90-336 \
1D 62-156
1c S8-342 \
14 22-24 \
</p>
<p>
Convert TOS from floating point format to fixed pomt format.
Convert TOS trom fixed point format te Boating point format.
</p>
<p>
36 26-28 Change sign of fixed point operand on TOS
</p>
<p>
18 16-20
7 16
37 =|
17 a
</p>
<p>
78 10
38 rd
18 42
</p>
<p>
79 %
39 26
9 26
</p>
<p>
tA 16
</p>
<p>
Change sign of floating point operand on TOS.
</p>
<p>
Push stack. Duplicate NOS in TOS.
</p>
<p>
Pop stack. Okt NOS becomes new TOS. Old TOS rotates to bottorn
</p>
<p>
Exchange TOS and NOS
</p>
<p>
Push floatng pomt constant 2 onto TOS Previous TOS becomes NOS
</p>
<p>
110
</p>
<p>
Patch to MBASIC for HSA-88B support 08-10-83
</p>
<p>
MACRO-80 3.44 09-Dec-8! PAGE 1
</p>
<p>
&laquo;Z80
</p>
<p>
title Patch to MBASIC for HSA-88B support 08-10-83
</p>
<p>
+m om tm ew
</p>
<p>
Py
</p>
<p>
on
</p>
<p>
OCcO4 fac
28b7 movrm
28A9 movfr
</p>
<p>
0080
0081
</p>
<p>
amd$a
amd$c
</p>
<p>
aes
</p>
<p>
0000&rsquo; O01 OOAB
0003&rsquo; 11 C000
0006&rsquo; 21 ocodc&rsquo;
0009&rsquo; ED BO
OOOB&rsquo; C9
</p>
<p>
oooc&rsquo; ttt:
</p>
<p>
s PHRERE
</p>
<p>
O00 C3 COIR
C003 C3 C022
C006 C3 C026
co0g c3 CO2A
cooc c3 Cco2F
COOF C3 C034
coi2 63 C039
co15 C3 COZE
co18 C3 C043
coiB c3 C048
</p>
<p>
cO1E 3E 10
co20 18 2B
co22 3B 12
co24 18 27
C026 3B 13
co28 18 23
CO2A 3B 09
co2c F5
</p>
<p>
co2D 18 22
co2F 3E O01
</p>
<p>
fpadd:
fpmpy:
fpdiv:
</p>
<p>
log:
</p>
<p>
sqrt
</p>
<p>
&lsquo;Hack&rsquo; for HSA-88B review
</p>
<p>
This code is assembled to a -COM file that is executed before 4@
patched version of MBASIC is run. The &lsquo;front end&rsquo; copies the
HSA-88B support routines up to OC000h. Mbasic should then be run
with the command:
</p>
<p>
MBASIC /M: &amp;HBFFF
to ensure that Mbasic does not use any memory above C000.
</p>
<p>
System equates
equ Oc04h
</p>
<p>
equ 028bd7h
equ 028a9h
</p>
<p>
Floating point accumulator
Routine to Load (HL) to registers
Routine to move BCDE to the FAC
</p>
<p>
tn ene
</p>
<p>
equ 80h ; AMD data port on HSA-&amp;68B
equ 8th ; AMD command port on HSA-885
</p>
<p>
_QEHEBEEEHEEEHHHOHEER pont Eid tHE Iie stb fete aE
</p>
<p>
Short routine to move code into high memory
</p>
<p>
1d
ld
1d
</p>
<p>
be, codelen
de,O0c000h
</p>
<p>
hi, ttt
</p>
<p>
idir
ret
</p>
<p>
* Rib He BH EE EE * HR KK WEE &copy;
</p>
<p>
-phase OcQ00h ; Locate them here
</p>
<p>
Address of where to patch MBASIC.
258B (ie change 258B to C3 00 CO...)
2707
</p>
<p>
276F
</p>
<p>
2604
</p>
<p>
dp fpadad
jp fpmpy
ap fpdiv
dp log
jp sqr
dp sin
dip cos
dp tan
ap atn
3p exp
</p>
<p>
Pe
</p>
<p>
B9IC
3951
3728
</p>
<p>
on am ew
</p>
<p>
Floating point ADD routine
</p>
<p>
1d a,iOh ; Add command
</p>
<p>
jr go
</p>
<p>
ld a,12h
</p>
<p>
gr go
</p>
<p>
ld a,13h
</p>
<p>
ar go
</p>
<p>
ld a,09
</p>
<p>
push af
</p>
<p>
dr gol 3; Only one operand
</p>
<p>
10
</p>
<?php columnEnd(1); ?>
