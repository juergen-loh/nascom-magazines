<?php columnStart(1); ?>
<p>
LISTING 3
</p>
<p>
MV256 Screen Dump to Epson FX80
</p>
<p>
dump:
</p>
<p>
&raquo;Z80
</p>
<p>
ld a,er
eall output
R
</p>
<p>
jMake sure we start new line
</p>
<p>
soutput linefeed selector
</p>
<p>
1d a,ese
eall output
R
</p>
<p>
ld a,three
call output
R
</p>
<p>
ld a,twnty4
call output
R
</p>
<p>
call getpar
R
</p>
<p>
ld ix,dumpmod
ld (ixt1),a
ld de, OOffh
</p>
<p>
nxtrow: Id a,ese
</p>
<p>
row:
</p>
<p>
call output
R
</p>
<p>
ld a,"*&rdquo;
eall output
R
</p>
<p>
ld a,gr4
call output
R
</p>
<p>
14 4,0
</p>
<p>
call output
R
</p>
<p>
1d a,t
</p>
<p>
call output
R
</p>
<p>
push de
</p>
<p>
1d b,8
</p>
<p>
14 c,0
</p>
<p>
1d h1,0000h
</p>
<p>
makbyt: call getcol
</p>
<p>
R
</p>
<p>
dumpmod:ep 0
</p>
<p>
skip:
skipi:
</p>
<p>
dr nz,skip
defb Ocbh,31h
</p>
<p>
jr skip1
slac
</p>
<p>
dec e
</p>
<p>
djngz makbyt
pop de
</p>
<p>
ine 1
</p>
<p>
jr nz,row
1d a,er
call output
R
</p>
<p>
ld a,lf
</p>
<p>
sselect linefeed spacing 24/216&rdquo;
;Spacing parameter
</p>
<p>
sget background colour
</p>
<p>
sstore colour at appropriate location
</p>
<p>
sSet B=255, D=0
</p>
<p>
soutput graphline selectors
</p>
<p>
s;select graphics mode 4
</p>
<p>
gno. chars mod 255
</p>
<p>
sno. chars div 255
</p>
<p>
;s8ave row
</p>
<p>
sinitialise byte for output
sset L=O, colum pointer, H=0
</p>
<p>
stest colour at pixel
</p>
<p>
sdoes it differ from background?
</p>
<p>
;*** UNDOCUMENTED Z80 INSTRUCTION ##+
sshifts register C left one bit, with
sa one shifting in from right
</p>
<p>
sset bit equal to 0
sadjust row pointer
</p>
<p>
srestore top row
</p>
<p>
call output
R
</p>
<p>
3E = E-8
push hl
</p>
<p>
ex de,hi ;rows now in hl
ld de,8
</p>
<p>
ora
</p>
<p>
sbc hl,de
</p>
<p>
ex de,hl
</p>
<p>
pop hl
</p>
<p>
jv ne,nxtrow
</p>
<p>
jreset line feeds
</p>
<p>
ld a,esc
eall output
R
</p>
<p>
1d a, two
call output
R
</p>
<p>
ret
</p>
<p>
zsoutput CRLF
</p>
<p>
jreset line spacing
</p>
<p>
if equ Oah
er equ Odh
ffeed equ Och
esc equ 1bh
gr4 equ 04h
one equ &ldquo;1&rdquo;
twnty4 equ 24 ;linefeed spacing
</p>
<p>
jlinefeed character
;carriage return
s;form feed character
</p>
<p>
3;selector for graphics mode 4
</p>
<p>
output: push af
push be
push de
push hl
push ix
push iy
ld e,a stransfer byte to be transmitted to correct reg
1d 0,5 sselect LST: device
eall bdos
pop iy
pop ix
pop hl
pop de
pop be
pop af
return
</p>
<p>
save registers
</p>
<p>
END
</p>
<p>
LISTING 4
</p>
<p>
521 REM REPLACE PREVIOUS CODE AT 521 et seq with
522 C=0:REM SELECT BLACK BACKGROUND COLOUR
</p>
<p>
523 CALL DUMP(C)
</p>
<p>
524 END
</p>
<p>
*#** ADD TO PRIMDEF FOLLOWING LINE *##
399 DUMP=MVBASE+99:REM THIS DEFINES DUMP&rsquo;S VALUE FOR CALL
</p>
<p>
53
</p>
<?php columnEnd(1); ?>
