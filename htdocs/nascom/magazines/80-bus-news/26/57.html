<?php columnStart(1); ?>
<p>
57
</p>
<p>
Memory Block Comparison Program M-80
</p>
<p>
E100
E000
</p>
<p>
0000&rdquo;
</p>
<p>
DOOO
DOO4
</p>
<p>
DOO7
</p>
<p>
DOOD
DOOE
DOOF
D012
DOW
DOI4
DOS
DO16
D019
DO1B
DOID
DOE
</p>
<p>
Do20
DO24
</p>
<p>
ED
31
</p>
<p>
21
1
1A
BE
c4
23
13
ES
</p>
<p>
01
28
</p>
<p>
Et
18
</p>
<p>
cg
</p>
<p>
73 #100
E000
</p>
<p>
0100
6100
</p>
<p>
DO25
</p>
<p>
6100
03
ED
</p>
<p>
7B B100
</p>
<p>
19 Nov 1983 19:19 PAGE 1
</p>
<p>
+Z80
Title Memory Block Comparison Program
</p>
<p>
+Comment
</p>
<p>
COMPARE V1.1 15/06/83, A. M. Davies
Written source supplied, transcribed DRH 19/11/83.
</p>
<p>
This program compares all the bytes in two blocks
of memory and types out on the console the HEX
values of the addresses in the lower block where
the bytes are different from the corresponding
bytes in the higher block. The start addresses of
the two blocks are defined as blocki and block2,
and the top address of block! to be checked is
loaded into &lt;BO&gt;, at blokitop. The program runs
from 0D000H.
</p>
<p>
The program was originally used to find a bad byte
in an EPROM version of MBASIC-80, which did not
run correctly although the tape version of the
same did. It took about 500mS to find the one byte
in 24K that was incorrect.
</p>
<p>
The program is not claimed to optimised in any way
whatever.&rdquo;
</p>
<p>
0e100h
0e000h
</p>
<p>
stcksave equ
newstack equ
</p>
<p>
aseg
org 0d000h
</p>
<p>
ld (stcksave),sp ; Save the RP/M stack
</p>
<p>
ld sp, newstack ; Set up new stack
blockt: id h1,100h 3; Start addr. of lo. block
block2: 1d de&nbsp;,6100h 3; Start addr. of hi. block
getbyte: 1d a, (de) ; Get byte from hi. block
</p>
<p>
ep (nl) 3 Compare with lo. block
</p>
<p>
eall nzg,taddr } If not equal report error
</p>
<p>
ine hl ; Increment both pointers
</p>
<p>
ine de
</p>
<p>
push hl 3 Save &lt;HL&gt;
</p>
<p>
or a 3 Clear any carry flag
blokitop: ld be&nbsp;,6100h 3 Check against top addr..
</p>
<p>
sbe h1,be 3 &laquo;for end
</p>
<p>
jr zyexit 3; If top then quit
</p>
<p>
pop hi ; Restore &lt;HL&gt; and..
</p>
<p>
dr getbyte 3 --loop for next byte
exit: ld sp,(stcksave) ; Get the stack back..
</p>
<p>
ret 3; and return
</p>
<p>
Memory Block Comparison Program M-80
</p>
<p>
D025
D026
D027
Bo28
D029
DO2B
DOZE
</p>
<p>
DO30
D031
D032
D033
DO36
D037
DO3A
DO3B
DO3C
DO3D
DOZE
</p>
<p>
DO3F
DO40
DO44
</p>
<p>
D042
DO43
D044
DO47
BO48
DO4B
</p>
<p>
Do4c
DO4E
D051
DO52
DO55
</p>
<p>
DOS6
DO58
DO5A
DO5B
DOSD
</p>
<p>
DOSE
DOSF
DOGO
DO61
DdOo62
D064
D067
D068
DOES
DO6A
DO6B
</p>
<p>
Bi
E5
7
cb
7D
cD
Ei
Di
Ci
wi
cg
</p>
<p>
F5
OT
OT
</p>
<p>
OT
cD
oa
</p>
<p>
cD
cg
</p>
<p>
E6
cD
</p>
<p>
cD
cg
</p>
<p>
ce
</p>
<p>
ce
cg
</p>
<p>
F5
C5
D5
</p>
<p>
OF
cD
EI
D1
Ci
Fi
cg
</p>
<p>
oD
DOSE
</p>
<p>
DO3F
</p>
<p>
DO3F
</p>
<p>
DO4c
DO4c
OF
DO56
DOSE
30
3A
OT
</p>
<p>
02
0005
</p>
<p>
taddr:
</p>
<p>
tbyte:
</p>
<p>
thex:
</p>
<p>
hexas:
</p>
<p>
conout:
</p>
<p>
&ldquo;
</p>
<p>
19 Nov 1983
push af
push be
push de
push hi
id e,Odh
call conout
1d e,Oah
</p>
<p>
3 Now put out the current address
pop hl
push hi
ld a,h
call thyte
1d a,l
eall thyte
pop hl
pop de
pop be
pop af
ret
push af
rlca
rlea
rlca
rlca
call thex
pop af
call thex
ret
and OFH
eall hexas
14a e,a
call conout
ret
add a,&rsquo;O&rsquo;
ep &lsquo;g&rsquo; +1
ret c
add a,7
ret
push af
push be
push de
push hl
ld c,2
eall 0005h
pop hl
pop de
pop be
pop af
ret
</p>
<p>
end
</p>
<p>
19:19 PAGE i-t
</p>
<p>
Save the registers
</p>
<p>
Type a CR and...
</p>
<p>
oo&raquo; an LF
</p>
<p>
Get &lt;HL&gt; back
</p>
<p>
Resave &lt;HL&gt; &ndash;
</p>
<p>
Type the hi. order byte
Type the lo. order byte
</p>
<p>
Restore the registers...
</p>
<p>
&laquo;-and return
</p>
<p>
Save &lt;AF&gt;
Rotate high nibble ...
&laquo;ee into low nibble
</p>
<p>
Print the nibble
Get &lt;AP&gt; back
Print the nibble
</p>
<p>
Mask the high nibble
</p>
<p>
Print the nibble
</p>
<p>
Convert to ASCIT
Check if &gt; 9
</p>
<p>
Return if not
Convert to character
</p>
<p>
Save the registers
</p>
<?php columnEnd(1); ?>
