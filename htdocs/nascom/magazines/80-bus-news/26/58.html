<?php columnStart(1); ?>
<p>
INTEL-HEX dump program
</p>
<p>
8400
8800
</p>
<p>
8880
9000
</p>
<p>
9010
9200
E000
oooD
</p>
<p>
0000&rdquo;
</p>
<p>
8000
8004
</p>
<p>
8007
8009
800C
800F
8012
</p>
<p>
ED
31
</p>
<p>
3E
32
32
32
32
</p>
<p>
TB 9200
E000
</p>
<p>
8881
9010
8881
</p>
<p>
M-80 20 Nov 1983 00:43 PAGE
</p>
<p>
+280
Title INTEL-HEX dump program
</p>
<p>
&raquo; Comment
</p>
<p>
INTEL-HEX DUMP V1.3, A. M. Davies
Written source supplied, transcribed DRH 19/11/83.
</p>
<p>
This program dumps out memory contents to the
screen and to the serial I/O (if &ldquo;P is active) in
INTEL-HEX format. The program runs from 8000H and
requires two parametera to be entered before
running &ndash; the start address of the memory area to
be dumped must be in locations 8800H and 8801H
(LSB first), and the number of 16 byte blocks to
be dumped must be in locations 9000H and 9001H
(LSB first). For example, 8800H and 8801H might
contain 00H and 01H, and 9000H and 9001H might
contain 80H and OOH. This gives the starting
address as O{00H with a total of 80H blocks, ie,
128 * 16 = 2048 bytes to be dumped. Note that the
start address is updated during the running of the
program, but the number of blocks value is not.
This facilitates further dumps from the next area
of memory without requiring further entry of
parameters.
</p>
<p>
The program was originally written to enable
memory contents to be dumped to an EPROM
programmer, and could no doubt be improved and
made much more user-friendly. &ldquo;
</p>
<p>
buffer equ
startadd equ
</p>
<p>
8400h
8800h
</p>
<p>
16 byte data buffer
</p>
<p>
Start address of data to be
dumped. N.B. This value
ince as data is dumped.
</p>
<p>
16 byte block counter
Number of 16 byte blocks to
dump. Not incremented by
program.
</p>
<p>
Same as recent!
</p>
<p>
recent! equ
recnum equ
</p>
<p>
8880h
9000h
</p>
<p>
recent2 equ
stcksv equ 9200h
newstack equ 0e000h
er equ Odh
</p>
<p>
lf equ Oah
</p>
<p>
904 Oh
</p>
<p>
ec
</p>
<p>
aseg
</p>
<p>
org 8000h
</p>
<p>
ld (stcksv) ,ap
ld sp, newstack
</p>
<p>
Save the old stack
Set new stack pointer
</p>
<p>
tm on
</p>
<p>
start: id a,O0 3; Clear recent! ...
ld (recenti),a
la (recenti+1),a
1d (recent2),a } ee. and recent2
ld (recenti+1),a
</p>
<p>
INTEL-HEX
</p>
<p>
8015
8018
801B
801D
</p>
<p>
8020
8023
8026
8027
802A
802D
8028
</p>
<p>
8031
</p>
<p>
8034
8038
8039
803D
803E
8040
</p>
<p>
8042
8045
8049
</p>
<p>
804A
B04D
804P
</p>
<p>
8052
8054
8056
8058
805B
805E
</p>
<p>
8061
8062
</p>
<p>
8065
8068
8069
806C
806D
</p>
<p>
806F
8070
8071
8074
</p>
<p>
8075
8076
8077
8078
8079
</p>
<p>
2A
14
</p>
<p>
ED
cD
</p>
<p>
ca]
</p>
<p>
2A
19
22
2A
19
22
</p>
<p>
2h
13
BT
20
cD
ED
cg
cD
1B
cD
16
cD
2a
eD
cD
ai
</p>
<p>
cD
</p>
<p>
23
10
</p>
<p>
dump program
</p>
<p>
8400
804A
</p>
<p>
0010
8880
</p>
<p>
8880
8800
</p>
<p>
8800
</p>
<p>
9000
5B 9010
</p>
<p>
53 9010
</p>
<p>
52
D3
</p>
<p>
80BE
TB 9200
</p>
<p>
8083
3A
8075
</p>
<p>
00
10
10
808E
8880
8085
808E
8400
</p>
<p>
808E
</p>
<p>
8096
</p>
<p>
02
</p>
<p>
M-80
</p>
<p>
loadbuff: 1d
ld
ldir
call
</p>
<p>
1d
1d
add
ld
ld
add
ld
</p>
<p>
ld
ld
ine
1d
or
sabe
dr
</p>
<p>
call
ld
ret
</p>
<p>
typerec: call
1d
eall
</p>
<p>
14
14
ld
call
1d
call
</p>
<p>
xor
call
</p>
<p>
ld
typebyte: 1d
call
ine
djnz
</p>
<p>
xor
sub
call
ret
</p>
<p>
conout: push
push
push
push
1d
</p>
<p>
\
</p>
<p>
20 Nov 1983
</p>
<p>
hi, (startadd)
de, buffer
</p>
<p>
typerec
</p>
<p>
de,16
</p>
<p>
hl, (recenti )
nl, de
(recent! ), hl
hl, (startadd)
hi,de
(startadd),hi
</p>
<p>
hl, (recnum)
de, (recent?)
de
(recent2),de
a
</p>
<p>
hl, de
</p>
<p>
nz, loadbuff
</p>
<p>
typendfl
sp, (stckav)
</p>
<p>
terlf
e,&rsquo;s&rsquo;
conout
</p>
<p>
4,0
</p>
<p>
b,16
</p>
<p>
a,i6
</p>
<p>
tebyte
</p>
<p>
hl, (recent )
tcaddr
</p>
<p>
a
tobyte
</p>
<p>
hl, buffer
a, (nl)
tebyte
</p>
<p>
hl
typebyte
</p>
<p>
a
d
tbyte
</p>
<p>
hl
de
be
af
c,2
</p>
<p>
enon
</p>
<p>
an om em om em ee Om am om nm te oe On ron te an
</p>
<p>
an om on em om em ae
</p>
<p>
oo
</p>
<p>
00:43 PAGE 1-1
</p>
<p>
Get the start pointer
Copy data to buffer
</p>
<p>
Type out the data
</p>
<p>
Update the pointer
in recent!
</p>
<p>
Update the value
in startadd
</p>
<p>
Get no. of blocks to send
Get block count value&nbsp;..
</p>
<p>
++ bump the count&nbsp;..
</p>
<p>
&laquo;+ and resave
</p>
<p>
Clear any carry flag
</p>
<p>
Test for end
</p>
<p>
If count &lt;&gt; size, do next&nbsp;..
</p>
<p>
+. else end
</p>
<p>
Send a CR LF
Send a block marker
</p>
<p>
Clear checksum to zero
Set block length in &lt;B&gt;
Set block length in &lt;A&gt;
Send the block
</p>
<p>
Send &lt;HL&gt; as the address
</p>
<p>
Clear &lt;A&gt;, then send &lt;A&gt; ..
+&raquo; as the block type
</p>
<p>
Get buffer in &lt;HL&gt;
Get a byte&nbsp;..
</p>
<p>
&raquo;-. and send it
Point to next
</p>
<p>
Do for &lt;B&gt; times
</p>
<p>
Clear &lt;A&gt;
Get checkaum&nbsp;..
+&raquo; and send it
</p>
<p>
Save the registers
</p>
<p>
Load &lt;C&gt; with conout
</p>
<p>
58
</p>
<?php columnEnd(1); ?>
